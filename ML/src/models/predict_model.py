import pickle
import pandas as pd
from data_preprocess import process_data
import numpy as np
from sklearn.model_selection import train_test_split
import matplotlib.pyplot as plt
import seaborn as sns
import itertools
from sklearn.metrics import accuracy_score, confusion_matrix
from TrainingAlgorithms import ClassificationAlgorithms
from sensor_input_df import sensor_data_to_df

def add_label_column_df(df, y_preds):
    df["label"] = y_preds
    return df

def predict_model(sensor_data):

    random_forest_model = pickle.load(open("random_forest_model.pkl", "rb"))

    # --------------------------------------------------------------
    # Load data and preprocess data
    # --------------------------------------------------------------
    sensor_df = sensor_data_to_df(sensor_data)    
    processed_df = process_data(sensor_df)

    y_preds = random_forest_model.predict(processed_df)
    labeled_df = add_label_column_df(processed_df, y_preds)
    return labeled_df

labeled_df = predict_model({'gyro': {'x': [-2.2442748091603053, -2.3969465648854964, -1.4122137404580153, -1.8091603053435115, -1.618320610687023, -1.3053435114503817, -2.0916030534351147, -1.5801526717557253, -1.8702290076335877, -3.854961832061069, -2.0610687022900764, -1.3587786259541985, -1.0, -2.0, -1.5114503816793894, -26.732824427480917, -8.900763358778626, 5.091603053435114, 206.6259541984733, 65.80916030534351, -250.13740458015266, -250.13740458015266, -189.55725190839695, -98.07633587786259, -168.26717557251908, -250.13740458015266, -250.13740458015266, 250.12977099236642, -250.13740458015266, 250.12977099236642, 207.09923664122138, 250.12977099236642, -250.13740458015266, -49.900763358778626, 250.12977099236642, 103.21374045801527, -27.00763358778626, -144.54961832061068, 175.74045801526717, -34.11450381679389, -21.259541984732824, 179.8091603053435, -2.7404580152671754, -1.1374045801526718, -1.6641221374045803, -0.31297709923664124, -1.1145038167938932, -1.984732824427481, -3.7557251908396947, -5.1679389312977095, -1.7328244274809161, -4.717557251908397, -2.7480916030534353, -0.8091603053435115, -0.8320610687022901, -2.381679389312977, -0.007633587786259542, -1.1603053435114503, -2.099236641221374, -3.4885496183206106], 'y': [0.31297709923664124, -0.7557251908396947, 0.3282442748091603, -0.6641221374045801, -0.5038167938931297, 0.31297709923664124, -0.7633587786259542, -0.5648854961832062, -0.03816793893129771, -0.6259541984732825, -0.46564885496183206, 0.9847328244274809, 1.0305343511450382, -0.22900763358778625, 0.7175572519083969, -25.366412213740457, -4.458015267175573, -3.282442748091603, -112.6412213740458, 250.12977099236642, 175.74809160305344, 250.12977099236642, 250.12977099236642, -25.69465648854962, 250.12977099236642, 250.12977099236642, 250.12977099236642, -250.13740458015266, 250.12977099236642, -250.13740458015266, -250.13740458015266, -171.7709923664122, 250.12977099236642, 250.12977099236642, -36.11450381679389, -31.442748091603054, 142.29770992366412, 70.87022900763358, -187.5801526717557, -20.47328244274809, -250.13740458015266, -141.0916030534351, -9.748091603053435, 0.15267175572519084, -0.3969465648854962, 0.4198473282442748, 1.0610687022900764, -0.6259541984732825, 3.6717557251908395, -6.679389312977099, 3.2519083969465647, -3.2977099236641223, -2.236641221374046, 1.0381679389312977, -0.26717557251908397, -0.6335877862595419, -0.4732824427480916, -0.03816793893129771, 1.8625954198473282, -1.3511450381679388], 'z': [-3.213740458015267, -1.6412213740458015, -0.6946564885496184, -0.7480916030534351, -0.29770992366412213, -0.5801526717557252, -0.31297709923664124, 1.2290076335877862, -1.6030534351145038, -0.1297709923664122, -1.1374045801526718, -0.29770992366412213, 1.099236641221374, -2.030534351145038, -0.816793893129771, -60.93129770992366, 9.282442748091603, 0.5267175572519084, -249.72519083969465, -9.923664122137405, 250.12977099236642, 66.0381679389313, 130.1145038167939, -37.541984732824424, -25.595419847328245, 250.12977099236642, -132.4351145038168, -250.13740458015266, 250.12977099236642, -250.13740458015266, -224.4732824427481, 250.12977099236642, 214.3053435114504, 62.50381679389313, 250.12977099236642, 73.01526717557252, 95.00763358778626, 99.87022900763358, 188.1679389312977, 164.25954198473283, 250.12977099236642, 238.40458015267177, -9.557251908396946, -1.5190839694656488, 1.83206106870229, 0.6564885496183206, 0.9923664122137404, -0.1450381679389313, -1.6106870229007633, -7.8320610687022905, 3.633587786259542, -2.9923664122137406, -2.4656488549618323, 1.0916030534351144, -0.17557251908396945, -0.6870229007633588, -0.05343511450381679, 0.3893129770992366, -1.8702290076335877, -0.8244274809160306]}, 'accel': {'x': [-5.398924743652343, -5.444414575195312, -5.439626171875, -5.480327600097656, -5.396530541992187, -5.396530541992187, -5.398924743652343, -5.432443566894531, -5.434837768554687, -5.437231970214843, -5.341463903808593, -5.449202978515625, -5.4013189453125, -5.391742138671875, -5.42047255859375, -4.474762902832031, -5.456385583496093, -5.310339282226562, -3.392583752441406, 3.418919970703125, 5.087678527832031, -4.302380383300781, 4.783614916992187, 14.283807104492187, 9.200916979980468, -9.957484704589843, -2.3032219970703123, -11.056423266601563, -16.575058093261717, 19.467253698730467, -1.5346832641601562, -19.6133, -16.704344982910154, -5.6574985229492185, -3.4931402221679684, -5.250484240722656, -5.722141967773437, -3.81156904296875, -2.5354595581054684, 3.3686417358398435, 4.189852905273438, -2.8730419921875, 1.0989385620117187, 0.7685387329101562, 0.9576806640625, 0.9337386474609375, 0.9121908325195311, 0.9026140258789062, 0.8451531860351562, 0.9600748657226562, 0.9935936889648437, 0.8858546142578124, 0.9504980590820312, 0.8547299926757812, 0.7900865478515624, 0.8451531860351562, 0.9265560424804687, 0.8643067993164062, 0.6727706665039062, 0.8834604125976562], 'y': [-7.395688928222656, -7.4028715332031245, -7.410054138183593, -7.426813549804687, -7.400477331542969, -7.45075556640625, -7.381323718261719, -7.381323718261719, -7.4220251464843745, -7.417236743164062, -7.44357296142578, -7.429207751464843, -7.4962453979492185, -7.419630944824219, -7.438784558105469, -8.061276989746093, -7.3286512817382805, -7.568071447753906, -10.232817895507813, 2.8012159423828122, -14.094665173339843, -6.007051965332031, -3.294421484375, -0.4333505004882812, -6.545747338867187, 9.428366137695312, -7.733271362304687, -19.6133, -19.6133, 7.012616662597656, -7.666233715820312, 17.702727075195313, -19.6133, -3.2513258544921873, 19.61270144958496, 6.986280444335937, 9.1554271484375, 7.036558679199218, 6.512228515625, 12.847286108398437, 2.5522189697265625, -2.602497204589844, -2.731784094238281, -2.042254016113281, -2.24097275390625, -1.915361328125, -2.1308394775390624, -1.9967641845703124, -2.023100402832031, -1.9393033447265624, -2.114080065917969, -1.8435352783203125, -2.1404162841796874, -1.936909143066406, -1.9608511596679685, -1.9800047729492187, -1.9416975463867185, -1.838746875, -1.89620771484375, -1.8698714965820311], 'z': [-3.6439749267578123, -3.718195178222656, -3.6750995483398436, -3.768473413085937, -3.756502404785156, -3.632003918457031, -3.727771984863281, -3.825934252929687, -3.6942531616210936, -3.73495458984375, -3.77326181640625, -3.763685009765625, -3.763685009765625, -3.787627026367187, -3.5314474487304683, -3.6439749267578123, -3.536235852050781, -3.603273498535156, -8.087613208007811, -9.964667309570311, 1.37906015625, -8.786720092773438, -13.692439294433592, 2.6312276245117188, 0.0526724365234375, 1.9297265380859374, -1.4221557861328125, -2.9281086303710935, -19.6133, -18.617312109375, -10.850521923828124, -0.201112939453125, -6.282385156249999, 2.5809493896484375, -1.0031704956054688, -4.125209460449218, -4.740519287109374, -0.3064578125, 2.5450363647460934, -7.1395093505859375, -0.6344634399414062, -11.396399902343749, -10.28549033203125, -10.04846436767578, -9.892841259765625, -10.32379755859375, -9.986215124511718, -10.079588989257813, -10.019733947753906, -10.000580334472655, -10.041281762695311, -10.067617980957031, -10.180145458984374, -9.964667309570311, -9.983820922851562, -10.070012182617187, -9.969455712890625, -10.101136804199218, -9.873687646484374, -9.967061511230469]}, 'timestamp_ms': {'ms': [1710500476878, 1710500477086, 1710500477293, 1710500477499, 1710500477705, 1710500477919, 1710500478133, 1710500478339, 1710500478546, 1710500478752, 1710500478958, 1710500479165, 1710500479371, 1710500479577, 1710500479783, 1710500479990, 1710500480196, 1710500480402, 1710500480609, 1710500480815, 1710500481021, 1710500481227, 1710500481434, 1710500481640, 1710500481846, 1710500482053, 1710500482259, 1710500482465, 1710500482671, 1710500482878, 1710500483084, 1710500483298, 1710500483511, 1710500483725, 1710500483938, 1710500484152, 1710500484365, 1710500484578, 1710500484792, 1710500485005, 1710500485219, 1710500485432, 1710500485646, 1710500485859, 1710500486073, 1710500486286, 1710500486499, 1710500486713, 1710500486926, 1710500487140, 1710500487353, 1710500487566, 1710500487780, 1710500487993, 1710500488203, 1710500488417, 1710500488630, 1710500488841, 1710500489055, 1710500489268]}})

